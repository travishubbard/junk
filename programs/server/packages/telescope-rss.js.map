{"version":3,"file":"/packages/telescope-rss.js","sources":["telescope-rss/lib/server/rss.js","telescope-rss/lib/server/routes.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,6B;;AAEA,0B;AACA,U;AACA,+B;AACA,uC;AACA,8C;AACA,mC;AACA,sD;AACA,I;AACA,E;;AAEA,2B;AACA,gC;;AAEA,a;AACA,4B;AACA,gC;AACA,I;AACA,iF;AACA,gE;AACA,e;AACA,uB;AACA,+E;AACA,yB;AACA,yB;AACA,4B;AACA,mB;AACA,O;AACA,K;;AAEA,oB;AACA,E;;AAEA,8B;AACA,gC;;AAEA,wG;AACA,yC;AACA,e;AACA,qC;AACA,iH;AACA,4B;AACA,4B;AACA,qC;AACA,sB;AACA,O;AACA,K;;AAEA,oB;AACA,E;;;;;;;;;;;;;;;;;;;AClDA,4B;;AAEA,yB;;AAEA,e;;AAEA,wB;AACA,sB;AACA,wB;AACA,0B;AACA,4C;AACA,4B;AACA,O;AACA,O;;AAEA,kB;;AAEA,gC;AACA,sB;AACA,gC;AACA,0B;AACA,+C;AACA,4B;AACA,O;AACA,O;;AAEA,K;;AAEA,G","sourcesContent":["var RSS = Npm.require('rss');\n\nvar getMeta = function() {\n  return {\n    title: getSetting('title'),\n    description: getSetting('tagline'),\n    feed_url: Meteor.absoluteUrl()+'feed.xml',\n    site_url: Meteor.absoluteUrl(),\n    image_url: Meteor.absoluteUrl()+'img/favicon.png',\n  };\n};\n\nservePostRSS = function() {\n  var feed = new RSS(getMeta());\n\n  filters = {\n    status: STATUS_APPROVED,\n    postedAt: {$lte: new Date()}\n  };\n  Posts.find(filters, {sort: {postedAt: -1}, limit: 20}).forEach(function(post) {\n    var description = !!post.body ? post.body+'</br></br>' : '';\n    feed.item({\n     title: post.title,\n     description: description+'<a href=\"'+getPostUrl(post._id)+'\">Discuss</a>',\n     author: post.author,\n     date: post.postedAt,\n     url: getPostLink(post),\n     guid: post._id\n    });\n  });\n\n  return feed.xml();\n};\n\nserveCommentRSS = function() {\n  var feed = new RSS(getMeta());\n\n  Comments.find({isDeleted: {$ne: true}}, {sort: {postedAt: -1}, limit: 20}).forEach(function(comment) {\n    post = Posts.findOne(comment.postId);\n    feed.item({\n     title: 'Comment on '+post.title,\n     description: comment.body+'</br></br>'+'<a href=\"'+getPostCommentUrl(post._id, comment._id)+'\">Discuss</a>',\n     author: comment.author,\n     date: comment.postedAt,\n     url: getCommentUrl(comment._id),\n     guid: comment._id\n    });\n  });\n\n  return feed.xml();\n};\n","Meteor.startup(function () {\n\n  Router.map(function() {\n\n    // Post RSS\n\n    this.route('feed', {\n      where: 'server',\n      path: '/feed.xml',\n      action: function() {\n        this.response.write(servePostRSS());\n        this.response.end();\n      }\n    });\n\n    // Comment RSS\n\n    this.route('rss_comments', {\n      where: 'server',\n      path: '/rss/comments.xml',\n      action: function() {\n        this.response.write(serveCommentRSS());\n        this.response.end();\n      }\n    });\n\n  });\n\n});\n"]}